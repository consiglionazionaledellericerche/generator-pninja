import { useState } from 'react';
import { useTranslation } from 'react-i18next';
import { useAuthState } from '../contexts/AuthContext';
import { useNavigate } from 'react-router-dom';
import { LogOut, Loader } from 'lucide-react';

export function LogoutButton() {
  const { logout } = useAuthState();
  const navigate = useNavigate();
  const { t } = useTranslation();
  const [isLoggingOut, setIsLoggingOut] = useState(false);

  const handleLogout = async () => {
    try {
      setIsLoggingOut(true);
      await logout();
      navigate('/');
    } catch (error) {
      console.error('Errore durante il logout:', error);
    } finally {
      setIsLoggingOut(false);
    }
  };

  return (
    <button
      onClick={handleLogout}
      disabled={isLoggingOut}
      className={`inline-flex items-center gap-1 nav-bar-link ${isLoggingOut ? 'opacity-70 cursor-not-allowed' : ''}`}
    >
      {isLoggingOut ? <Loader size={16} className="animate-spin" /> : <LogOut size={16} />}
      {isLoggingOut ? t('ui.account.loggingOut') : t('ui.account.logout')}
    </button>
  );
}
