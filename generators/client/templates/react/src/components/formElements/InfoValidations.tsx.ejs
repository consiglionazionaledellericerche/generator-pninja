import { useTranslation } from 'react-i18next';
import { Button, OverlayArrow, Tooltip, TooltipTrigger, Text } from 'react-aria-components';
import { AsteriskIcon, InfoIcon } from 'lucide-react';
import prettyBytes from 'pretty-bytes';

interface InfoValidationsProps {
  validations: IInfoValidations;
}
interface IInfoValidations {
  min?: number;
  minbytes?: number;
  minlength?: number;
  max?: number;
  maxbytes?: number;
  maxlength?: number;
  pattern?: string | RegExp;
  required?: boolean;
  unique?: boolean;
}

const InfoRequired: React.FC = () => {
  const { t } = useTranslation();
  return (
    <TooltipTrigger delay={0}>
      <Button>
        <AsteriskIcon className="size-5 sm:size-4" />
      </Button>
      <Tooltip>
        <OverlayArrow>
          <svg
            width={8}
            height={8}
            viewBox="0 0 8 8"
            className="fill-slate-300 dark:fill-slate-700"
          >
            <path d="M0 0 L4 4 L8 0" />
          </svg>
        </OverlayArrow>
        <div className="bg-slate-300 text-slate-800 dark:bg-slate-700 dark:text-slate-200 text-sm p-2 rounded-lg shadow-md dark:shadow-md/70">
          {t('info.validations.required')}
        </div>
      </Tooltip>
    </TooltipTrigger>
  );
};

const InfoValidations: React.FC<InfoValidationsProps> = ({ validations }) => {
  const { t } = useTranslation();
  return (
    <>
      {validations.required && <InfoRequired />}
      {Object.keys(validations).some((validation) =>
        ['min', 'max', 'minbytes', 'maxbytes', 'minlength', 'maxlength', 'unique'].includes(
          validation
        )
      ) && (
        <TooltipTrigger delay={0}>
          <Button>
            <InfoIcon className="size-5 sm:size-4" />
          </Button>
          <Tooltip>
            <OverlayArrow>
              <svg
                width={8}
                height={8}
                viewBox="0 0 8 8"
                className="fill-slate-300 dark:fill-slate-700"
              >
                <path d="M0 0 L4 4 L8 0" />
              </svg>
            </OverlayArrow>
            <div className="bg-slate-300 text-slate-800 dark:bg-slate-700 dark:text-slate-200 text-sm p-2 rounded-lg shadow-md dark:shadow-md/70">
              <Text slot="description">
                {typeof validations.min === 'number' && (
                  <div>{t(`info.validations.min`, { accepted: validations?.min })}</div>
                )}
                {typeof validations.max === 'number' && (
                  <div>{t(`info.validations.max`, { accepted: validations?.max })}</div>
                )}
                {typeof validations.minbytes === 'number' && (
                  <div>
                    {t(`info.validations.minbytes`, {
                      accepted: prettyBytes(Number(validations?.minbytes)),
                    })}
                  </div>
                )}
                {typeof validations.maxbytes === 'number' && (
                  <div>
                    {t(`info.validations.maxbytes`, {
                      accepted: prettyBytes(Number(validations?.maxbytes)),
                    })}
                  </div>
                )}
                {typeof validations.minlength === 'number' && (
                  <div>{t(`info.validations.minlength`, { accepted: validations?.minlength })}</div>
                )}
                {typeof validations.maxlength === 'number' && (
                  <div>{t(`info.validations.maxlength`, { accepted: validations?.maxlength })}</div>
                )}
                {validations.unique && <div>{t(`info.validations.unique`)}</div>}
              </Text>
            </div>
          </Tooltip>
        </TooltipTrigger>
      )}
    </>
  );
};

export { InfoValidations };
export type { IInfoValidations };
