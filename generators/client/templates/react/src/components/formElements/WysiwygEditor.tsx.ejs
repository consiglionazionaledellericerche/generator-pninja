import ReactQuill from 'react-quill';
import 'react-quill/dist/quill.snow.css';
import './wysiwyg-editor.css';
function cleanHtmlValue(html: string | null | undefined): string {
  if (!html) return '';
  const temp = document.createElement('div');
  temp.innerHTML = html.trim();
  const textContent = temp.textContent
    .replace(/\u200B/g, ''
    .trim();
  return textContent.length === 0 ? '' : html;
}

interface WysiwygEditorProps {
  hasErrors?: boolean;
  onChange?(value: string): void;
  defaultValue?: string;
}

const modules = {
  toolbar: {
    container: [
      [{ header: [1, 2, 3, false] }],
      ['bold', 'italic', 'underline', 'strike'],
      [{ list: 'ordered' }, { list: 'bullet' }],
      [{ color: [] }, { background: [] }],
      ['link'],
      ['image', 'video'],
      ['clean'],
      ['undo', 'redo'],
    ],
    handlers: {
      undo: function () {
        this.quill.history.undo();
      },
      redo: function () {
        this.quill.history.redo();
      },
    },
  },
  history: {
    delay: 1000,
    maxStack: 500,
    userOnly: true,
  },
};

const WysiwygEditor: React.FC<WysiwygEditorProps> = ({
  hasErrors,
  onChange,
  defaultValue,
}) => {
  return (
    <div
      className={`
      ${hasErrors ? 'outline-2 -outline-offset-2 outline-red-500' : 'outline-0'}
      focus-within:outline-2
      focus-within:-outline-offset-2
      ${hasErrors ? 'focus-within:outline-red-500' : 'focus-within:outline-blue-600'}
      rounded-md
      block
      w-full
      mt-3
      border-none
      bg-neutral-50 text-neutral-900
      text-sm/6
      shadow-sm
      `}
    >
      <ReactQuill
        theme="snow"
        value={cleanHtmlValue(defaultValue)}
        onChange={(value) => onChange && onChange(cleanHtmlValue(value))}
        modules={modules}
      />
    </div>
  );
};

export default WysiwygEditor;
