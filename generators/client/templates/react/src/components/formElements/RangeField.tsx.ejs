import { useFormContext, useController } from 'react-hook-form';
import { FormLabelAria as FormLabel } from './index';
import { Slider, SliderOutput, SliderThumb, SliderTrack, SliderProps } from 'react-aria-components';

interface RangeFieldProps extends Omit<SliderProps, 'minValue' | 'maxValue' | 'children'> {
  fieldName: string;
  label: string;
  minValue: number;
  maxValue: number;
}

const RangeField: React.FC<RangeFieldProps> = ({
  fieldName,
  label,
  minValue,
  maxValue,
  ...ariaProps
}) => {
  const { control } = useFormContext();

  const { field } = useController({
    name: fieldName,
    control,
  });

  return (
    <Slider
      {...ariaProps}
      {...field}
      value={field.value}
      step={ariaProps.step ? Number(ariaProps.step) : 1}
      minValue={minValue}
      maxValue={maxValue}
      className={'has-[>[data-orientation=horizontal]]:grid grid-cols-2 gap-0 w-full pb-2'}
    >
      <FormLabel
        validations={{
          min: minValue,
          max: maxValue,
        }}
      >
        {label}
      </FormLabel>
      <SliderOutput className="ltr:text-right rtl:text-left" aria-live="polite" />
      <SliderTrack className="group col-span-2 relative data-[orientation=horizontal]:h-2 data-[orientation=horizontal]:w-full data-[orientation=vertical]:ms-2 data-[orientation=vertical]:h-[200px] data-[orientation=vertical]:w-2 rounded-full bg-slate-200 dark:bg-slate-600 mt-3">
        <SliderThumb className="group-data-[orientation=horizontal]:top-[50%] group-data-[orientation=vertical]:left-[50%] bg-blue-600 dark:bg-blue-300 h-6 w-6 rounded-full data-dragging:outline-2 data-dragging:outline-offset-3 data-dragging:outline-blue-600 data-dragging:dark:outline-blue-300 data-focus-visible:outline-2 data-focus-visible:outline-offset-3 data-focus-visible:outline-blue-500 ring-3 ring-slate-50 dark:ring-slate-900 " />
      </SliderTrack>
    </Slider>
  );
};

export { RangeField };
