import { useEffect, useRef } from 'react';
import { useAuthState } from '../hooks/useAuthState';
import { SimpleLoader } from './SimpleLoader';

interface LoginRedirectorProps {
  redirectUrl?: string;
}

export const LoginRedirector: React.FC<LoginRedirectorProps> = ({ redirectUrl }) => {
  const { login } = useAuthState();
  const hasRedirected = useRef(false);

  useEffect(() => {
    if (!hasRedirected.current) {
      hasRedirected.current = true;

      // Salva l'URL di reindirizzamento se fornito
      if (redirectUrl) {
        localStorage.setItem('authRedirectUrl', redirectUrl);
      }

      // Esegui il login in un contesto di esecuzione pulito
      login();
    }
  }, [login, redirectUrl]);

  return (
    <div className="absolute top-0 left-0 right-0 bottom-0 flex items-center justify-center bg-slate-50 dark:bg-slate-900">
      <SimpleLoader />
    </div>
  );
};
