import { useNavigate } from 'react-router-dom';
import { useTranslation } from 'react-i18next';
import { AxiosError } from 'axios';
import axiosInstance from '../../shared/axiosInstance';
import { ErrorResponseData, useNotifications } from '../../contexts/NotificationContext';
import ConfirmButton from '../ConfirmButton';

interface DeleteButtonProps {
  id: string | number | null | undefined;
}

const <%= entity.name %>DeleteButton: React.FC<DeleteButtonProps> = ({ id }) => {
  const { t } = useTranslation();

  const navigate = useNavigate();
  const { addNotification } = useNotifications();

  const deleteRecord = (id: string | number | null | undefined) => {
    if (!id) return;
    axiosInstance
      .delete(`/api/<%=to.slug(pluralize(entity.name))%>/${id}`)
      .then(() => {
        addNotification({
          type: 'success',
          message: t(`actions.crud.successfullyDeleted`, { id }),
        });
        navigate('/entities/<%=to.slug(pluralize(entity.name))%>');
      })
      .catch((error: AxiosError<ErrorResponseData>) => {
        addNotification({
          type: 'error',
          message: `${t('errors.entities.delete')} ${t('entities:<%-to.snake(entity.name)%>.<%= entity.name %>')} ID ${id}`,
          error,
        });
      });
  };

  return (
    <ConfirmButton
      onConfirm={() => deleteRecord(Number(id))}
      className="danger-button"
      pendingClassName="danger-button"
      label={t('actions.crud.delete')}
      pendingLabel={
        <span className="flex items-center gap-2">{t('actions.crud.confirmDelete')}</span>
      }
    />
  );
};
export default <%= entity.name %>DeleteButton;
