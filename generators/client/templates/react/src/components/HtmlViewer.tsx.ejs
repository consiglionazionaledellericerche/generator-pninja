import React, { useState } from 'react';
import { IconEyeFilled, IconCode, IconBulbFilled, IconBulbOff } from '@tabler/icons-react';
import { Button } from 'react-aria-components';
import { useTranslation } from 'react-i18next';
import { useId } from 'react-aria';

interface TextareaProps {
  content: string | null | undefined;
}

const HtmlViewer: React.FC<TextareaProps> = ({ content }) => {
  const { t } = useTranslation();
  const [showSource, setShowSource] = useState(false);
  const [dark, setDark] = useState(false);
  const textareaId = useId();
  const uid = textareaId.replace(/:/g, '--');

  return (
    <div>
      <div
        role="toolbar"
        aria-label={t('ui.htmlViewer.controls')}
        className="flex justify-between items-center mb-2"
      >
        <Button
          onClick={() => setShowSource(!showSource)}
          aria-label={t(showSource ? 'ui.htmlViewer.viewRendering' : 'ui.htmlViewer.viewSource')}
          aria-pressed={showSource}
          className="inline-flex gap-1 p-0.5 bg-slate-300 hover:bg-slate-400 text-slate-800 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-slate-200 mb-2 rounded-full cursor-pointer transition-colors focus:outline-2 focus:outline-offset-2 focus:outline-blue-600 focus:dark:outline-sky-300"
        >
          <IconEyeFilled
            aria-hidden="true"
            className={`size-7 rounded-full ${!showSource ? 'bg-white text-neutral-800 dark:bg-black' : ''} dark:text-neutral-200 hover:text-black hover:dark:text-white p-1`}
          />
          <IconCode
            aria-hidden="true"
            className={`size-7 rounded-full ${showSource ? 'bg-white text-neutral-800 dark:bg-black' : ''} dark:text-neutral-200 hover:text-black hover:dark:text-white p-1`}
          />
        </Button>
        {!showSource && (
          <Button
            onClick={() => setDark(!dark)}
            aria-label={t(dark ? 'ui.darkmode.light' : 'ui.darkmode.dark')}
            aria-pressed={dark}
            className="inline-flex gap-1 p-0.5 bg-slate-300 hover:bg-slate-400 text-slate-800 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-slate-200 mb-2 rounded-full cursor-pointer transition-colors  focus-within:outline-2 focus-within:outline-offset-2 focus-within:outline-blue-600 focus-within:dark:outline-sky-300"
          >
            <IconBulbFilled
              aria-hidden="true"
              className={`size-7 rounded-full ${!dark ? 'bg-white text-neutral-800 dark:bg-black' : ''} dark:text-neutral-200 hover:text-black hover:dark:text-white p-1`}
            />
            <IconBulbOff
              aria-hidden="true"
              className={`size-7 rounded-full ${dark ? 'bg-white text-neutral-800 dark:bg-black' : ''} dark:text-neutral-200 hover:text-black hover:dark:text-white p-1`}
            />
            <span className="sr-only">
              {t(dark ? 'ui.darkmode.darkOn' : 'ui.darkmode.lightOn')}
            </span>
          </Button>
        )}
      </div>
      {showSource && (
        <div className="bg-black text-emerald-400 p-2 rounded-md font-mono text-sm focus-within:outline-2 focus-within:outline-offset-2 focus-within:outline-blue-600 focus-within:dark:outline-sky-300">
          <label htmlFor={textareaId} className="sr-only">
            {t('ui.htmlViewer.source')}
          </label>
          <textarea
            id={textareaId}
            readOnly={true}
            aria-readonly={true}
            className="code w-full min-h-[300px] focus:outline-none"
          >
            {content}
          </textarea>
        </div>
      )}
      {!showSource && (
        <>
          <div
            id={`pn-htmlviewer-${uid}`}
            role="region"
            aria-label={t('ui.htmlViewer.renderedContent')}
            className={`p-2 rounded-lg shadow ${!dark ? 'bg-neutral-50 text-black' : 'text-white bg-neutral-950'} rounded-lg`}
            dangerouslySetInnerHTML={{ __html: content || '' }}
          ></div>
          <style>{`
        #pn-htmlviewer-${uid} {
          padding: 1rem;
          border-radius: 0.375rem;
        }
        #pn-htmlviewer-${uid} table,
        #pn-htmlviewer-${uid} th,
        #pn-htmlviewer-${uid} td {
          border: 1px solid;
        }
        #pn-htmlviewer-${uid} h1 {
          font-size: 2rem !important;
          font-weight: 700 !important;
          line-height: 1.2 !important;
          margin: 1.5rem 0 0.75rem 0 !important;
        }

        #pn-htmlviewer-${uid} h2 {
          font-size: 1.5rem !important;
          font-weight: 600 !important;
          line-height: 1.3 !important;
          margin: 1.25rem 0 0.5rem 0 !important;
        }

        #pn-htmlviewer-${uid} h3 {
          font-size: 1.25rem !important;
          font-weight: 600 !important;
          line-height: 1.4 !important;
          margin: 1rem 0 0.5rem 0 !important;
        }

        #pn-htmlviewer-${uid} p {
          margin: 0.75rem 0 !important;
          line-height: 1.6 !important;
        }

        #pn-htmlviewer-${uid} strong {
          font-weight: 700 !important;
        }

        #pn-htmlviewer-${uid} em {
          font-style: italic !important;
        }

        #pn-htmlviewer-${uid} ul {
          list-style-type: disc !important;
          margin: 1rem 0 !important;
          padding-left: 2rem !important;
        }

        #pn-htmlviewer-${uid} ol {
          list-style-type: decimal !important;
          margin: 1rem 0 !important;
          padding-left: 2rem !important;
        }

        #pn-htmlviewer-${uid} li {
          margin: 0.25rem 0 !important;
          line-height: 1.6 !important;
        }

        #pn-htmlviewer-${uid} a {
          color: #${dark ? '60a5fa' : '2563eb'} !important;
          text-decoration: underline !important;
        }

        #pn-htmlviewer-${uid} a:hover {
          color: #${dark ? '3b82f6' : '1d4ed8'} !important;
        }

        #pn-htmlviewer-${uid} img {
          max-width: 100% !important;
          height: auto !important;
          margin: 1rem 0 !important;
          border-radius: 0.375rem !important;
        }

        #pn-htmlviewer-${uid} blockquote {
          border-left: 4px solid #e5e7eb !important;
          margin: 1.5rem 0 !important;
          padding: 0.5rem 0 0.5rem 1rem !important;
          font-style: italic !important;
        }

      `}</style>
        </>
      )}
    </div>
  );
};

export default HtmlViewer;
