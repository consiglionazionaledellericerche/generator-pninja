import axios, { AxiosInstance, AxiosError } from 'axios';

const setupInterceptors = (axiosInstance: AxiosInstance) => {
  // Interceptor for responses
  axiosInstance.interceptors.response.use(
    (response) => response, // Return the response if successful
    (error: AxiosError) => {
      if (error.response?.status === 401) {
        console.log('ðŸ”„ Session expired, redirecting to login...');
        location.href = '/login'; // Redirects to the login page
      }
      // Ignore CanceledError
      if (axios.isCancel(error)) {
        console.warn(`Request canceled:`, error.message);
        return Promise.resolve(); // Resolve the Promise without propagating the error
      }
      console.error('ðŸš« Response error:', error);
      return Promise.reject(error); // Propagates the error
    }
  );

  // Interceptor for requests
  axiosInstance.interceptors.request.use(
    (config) => {
      console.log(`Sending ${config.method?.toUpperCase()} request to ${config.url}`, config.data);
      return config;
    },
    (error) => {
      console.error('ðŸš« Request error:', error);
      return Promise.reject(error);
    }
  );
};

export default setupInterceptors;
