import { useState, useEffect } from 'react';
import { useTranslation } from 'react-i18next';
import { useAuthenticatedFetch } from '../../hooks/useAuthenticatedFetch';
import { TableSkeletonLoader } from '../../components/TableSkeletonLoader';
import { I<%= entity.name %> } from '../../shared/model/<%= to.slug(entity.name)%>.model';

export default function <%= entity.name %>() {
  const { t } = useTranslation();
  const authenticatedFetch = useAuthenticatedFetch();
  const [<%=to.camel(pluralize(entity.name))%>, <%=to.camel(pluralize(`set${entity.name}`))%>] = useState<I<%= entity.name %>[]>([]);
  const [loading, setLoading] = useState(false);

  const handleSearch = () => {
    setLoading(true);
    authenticatedFetch(`/api/<%=to.slug(pluralize(entity.name))%>`)
      .then((response) => response.json())
      .then((data: I<%= entity.name %>[]) => {
        <%=to.camel(pluralize(`set${entity.name}`))%>(data);
        setLoading(false);
      })
      .catch((error) => {
        console.error('ERR:', error);
        setLoading(false);
        // alert('ERR');
      });
  };

  useEffect(() => {
    handleSearch();
  }, []);

  return <div className="m-4">
    <h1 className="text-2xl mb-4">{t('entities.<%- to.capital(pluralize(entity.name))%>')}</h1>
    <TableSkeletonLoader loading={loading} rows={10} cols={<%=fillableProperties.length%>} />
    {!loading && <%=to.camel(pluralize(entity.name))%> && <%=to.camel(pluralize(entity.name))%>.length > 0 && (
      <div className="relative overflow-x-auto">
      <table className="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
        <thead className="text-xs uppercase text-gray-700 bg-gray-200 dark:bg-gray-700 dark:text-gray-400">
          <tr>
            <% for(prop of fillableProperties) {%>
            <th scope="col" className="px-6 py-3">
              <%= to.capital(prop)%>
            </th>
            <%}%>
          </tr>
        </thead>
        <tbody>
          {<%=to.camel(pluralize(entity.name))%>.map((row, key) => (
            <tr key={key} className="odd:bg-white odd:dark:bg-gray-900 even:bg-gray-50 even:dark:bg-gray-800 border-b dark:border-gray-700 border-gray-200">
              <% for(prop of fillableProperties) {%>
              <td className="px-6 py-4">{row.<%= prop%>}</td>
              <%}%>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
    )}
  </div>;
}
