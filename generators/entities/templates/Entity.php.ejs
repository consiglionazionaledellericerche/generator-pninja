<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;
<% relationsType.forEach(function(rel) { %>use Illuminate\Database\Eloquent\Relations\<%- rel %>;
<% }); %>
use Laravel\Scout\Searchable;
<% if (hasBlobs) { -%>
use App\Casts\Base64BinaryCast;
<% }; -%>
<% enums.forEach(function(enm) { %>use App\Enums\<%- enm %>;
<% }); %>
class <%- className %> extends Model
{
    use HasFactory;
    use Searchable;

    protected $table = '<%- tableName %>';
<%  if(hidden) {-%>
    protected $hidden = [<%- hidden %>];
<%  }-%>
<%  if((castsClasses && castsClasses.length) || (casts && casts.length)) {-%>
    protected $casts = [
<%      castsClasses.forEach(function(cast) { -%>
<%          cast.attrsName.forEach(function(attrName) { -%>
        '<%- attrName %>' => <%- cast.className %>::class,
<%          }); -%>
<%      }); -%>
<%      casts.forEach(function(cast) { -%>
<%          cast.attrsName.forEach(function(attrName) { -%>
        '<%- attrName %>' => '<%- cast.cast %>',
<%          }); -%>
<%      }); -%>
    ];
<%  }-%>
<%  if (fillable) { -%>
    protected $fillable = [
        <%- fillable %>
    ];
<%  }-%>
    public function toSearchableArray()
    {
        return [
            'id' => <%- searchEngine === 'typesense' ? '(string) ' : '' %>$this->id,
<%  if (['typesense', 'solr'].includes(searchEngine)) { -%>
            '__id<%- searchEngine === 'solr' ? '_i' : '' %>' => $this->id,
<%  }-%>
<%  toSearchableArray.map(prop => { -%>
            '<%- prop %><%- searchEngine === 'solr' ? getSolrSuffix(toSearchableArrayTypes[prop]) : '' %>' => <%- searchEngine === 'typesense' ? '(string) ' : '' %>$this-><%- prop %><%- (enumColumns.includes(prop)) ? '?->value' : '' %>,
<%  })-%>
<%  if (['elastic','solr'].includes(searchEngine)) { -%>
            '__fulltext<%- searchEngine === 'solr' ? '_t' : '' %>' => implode(' ', array_filter([
                $this->id,
<%      toSearchableArray.map(prop => { -%>
                $this-><%- prop %><%- (enumColumns.includes(prop)) ? '?->value' : '' %><%- toSearchableArrayTypes[prop] === 'Boolean' ? ` ? 'true' : 'false'` : '?? null'%>,
<%      })-%>
            ]))
<%  }-%>
        ];
    }
<%  if (searchEngine === 'solr') { -%>
    public function searchableAs()
	{
	    return config('scout.prefix').$this->getTable();
	}
<%  }-%>
<%  if(typesenseSearchParameters) {-%>
<%- typesenseSearchParameters %>
<%  }-%>
<%  if (relations) { -%>
    <%- relations -%>
<%  }-%>
}