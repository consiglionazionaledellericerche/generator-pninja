<?php
namespace App\Http\Controllers;

use App\Models\<%- className %>;
use App\Traits\HandlesApiErrors;
use Illuminate\Http\Request;
use Illuminate\Database\QueryException;
use Illuminate\Database\Eloquent\ModelNotFoundException;

class <%- className %>Controller extends Controller
{
    use HandlesApiErrors;

    public function index()
    {
        <% if (withs) { %>
        return response()->json(<%- className %>::with(<%- withs %>)->get());
        <% } else { %>
        return response()->json(<%- className %>::all());
        <% } %>
    }

    public function show($id)
    {
        <% if (withs) { %>
        return response()->json(<%- className %>::with(<%- withs %>)->find($id));
        <% } else { %>
        return response()->json(<%- className %>::find($id));
        <% } %>
    }

    public function store(Request $request)
    {
        dump($request->all());

        $<%- entityName %> = <%- className %>::create($request->all());

        <% if (createRelated) { %><%- createRelated %><% } %>

        <% if (withs) { %>$<%- entityName %> = <%- className %>::with(<%- withs %>)->findOrFail($<%- entityName %>->id);<% } %>
        
        return response()->json($<%- entityName %>, 201);
    }

    public function update($id, Request $request)
    {
        dump($request->all());

        <% if (withs) { %>
        $<%- entityName %> = <%- className %>::with(<%- withs %>)->findOrFail($id);
        <% } else { %>
        $<%- entityName %> = <%- className %>::findOrFail($id);
        <% } %>

        $<%- entityName %>->update($request->all());

        <% if (createRelated) { %><%- createRelated %><% } %>

        return response()->json($<%- entityName %>, 200);
    }

    public function destroy($id)
    {
        try {
            <%- className %>::findOrFail($id)->delete();
            return response(null, 200);
        } catch (QueryException $e) {
            return $this->handleDeleteError($e);
        }
    }
}
