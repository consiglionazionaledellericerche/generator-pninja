<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\FileController;
use App\Http\Controllers\SessionAuthController;
<% eRoutes.forEach(({className}) => {-%>
use App\Http\Controllers\<%- className %>Controller;
<% }); -%>

Route::prefix('auth')->group(function () {
    Route::get('/check-session', [SessionAuthController::class, 'checkSession']);
    Route::post('/initiate-login', [SessionAuthController::class, 'initiateLogin']);
    Route::post('/logout', [SessionAuthController::class, 'logout']);
    Route::get('/csrf-token', [SessionAuthController::class, 'getCsrfToken']);
    Route::get('/callback', [SessionAuthController::class, 'handleCallback']);
});

// API protette: /api/my-entities, /api/files/*
Route::middleware(['session.auth'])->group(function () {
<% eRoutes.forEach(({className, rootPath}) => {-%>
    Route::apiResource('<%- rootPath %>', <%- className %>Controller::class);
<% }); -%>

    Route::get('/files/{path}', [FileController::class, 'serveFile'])
        ->where('path', '.*')
        ->name('files.serve');
});